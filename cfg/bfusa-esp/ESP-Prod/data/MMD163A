APPL MMD163A WAIT

INVOKE 'SWS.ESP.APPL.PROCLIB(#DISTRIB)'

/*********************************************************************/
/*05/09/2018 -JFC- CHANGED EVENT PREFIX FROM AK01 TO MM01
/*********************************************************************/
/*INT-443 INT-441 INT-442 SAP To/From MSIS Mold System*/
/* 04/21/2022 - SCTASK0135568 - changed user ID
/* 04/27/2022 - INC0272809 - changed domain
/*09/12/2022-for agent CYBA_CDC1AKFIS user maestro changed to
/*           bfusa\maestro - INC0353221
/*********************************************************************/

NOTIFY ABEND FAILURE ALERT(REMD)
NOTIFY ABEND FAILURE OVERDUE MAILBOX(AJKRONJOBREQ)

DATA_OBJECT PARMSET.!ESPAPPL
   /*Create a timestamp in hhmmMMDDYY format*/
   SETVAR TMSTMP='!ESPSHH.:!ESPSMN.,!ESPSMM./!ESPSDD./!ESPSYY'
   SETVAR PID=''
   SETVAR STMPTM='!ESPSMM./!ESPSDD./!ESPSYY.,!ESPSHH.:!ESPSMN'
ENDJOB

JOB LIS.!ESPAPPL LINK PROCESS
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI15_SAP_TO_MSIS_PO_ADD_CHG)
ENDJOB

SAP_JOB ZMMPOI15_SAP_TO_MSIS_PO_ADD_CHG
   AGENT CYBB_BFP030
   SAPJOBNAME ZMMPOI15_SAP_TO_MSIS_PO_ADD_CHG
   SAPJOBCLASS C
   STARTMODE ASAP
   ABAPNAME ZMMPOI15
   VARIANT 'ADD/CHG PROD'
   STEPUSER SAPADM
   LANGUAGE E
   PRINTCOPIES 001
   PRINTREL YES
   EXPIRATION 8
   COLUMNS 170
   BANNER D
   ARCMODE PRINT
   RUN WORKDAYS
   NOTIFY FAILURE EVENT(SW01.RESUBJOB)
   NOTIFY ABEND FAILURE ALERT(REMD)
   RELEASE ADD(ZMMPOI15CD)
ENDJOB

JOB SETPID.!ESPAPPL LINK PROCESS
   /*get the next PID number from the ConnectDirect*/
   /*Process ID table (CDPROD).  Save the value into*/
   /*the applications DataObject for use by the C:D*/
   /*job and the CDSTAT job (if needed).*/
   VINCR (PID) TABLE(CDPROD) CLANG
   VGET  (PID) TABLE(CDPROD) CLANG
   ESP MGRMSG * . . . PARMSET.!ESPAPPL/!ESPAPPL..!ESPAPGEN/MAIN +
ACTION SET PID(!PID)
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI15CD)
ENDJOB

UNIX_JOB ZMMPOI15CD
   AGENT CYBA_ISBFP3
   USER cdprod
   EARLYSUB REALNOW PLUS 20 SECONDS
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   TMSTMP= WOBDATA('PARMSET.!ESPAPPL','TMSTMP')
   /*@@ "/apps/condir/bfsbin/submit.sh zmmpoi15.cd 5"*/
   SCRIPTNAME /apps/condir/bfsbin/submitcd.sh
   ARGS zmmpoi15.cd 15 !PID !TMSTMP
   RUN WORKDAYS
   NOTIFY FAILURE EVENT(SW01.RESUBJOB)
   NOTIFY ABEND FAILURE ALERT(REMD)
   RESOURCE ADD(1,ISBFP3CD)
   RELEASE ADD(CDSTAT.ZMPOIZ28(A))
   RELEASE ADD(MSIS_DATA_LOADBAT)
ENDJOB

AIX_JOB CDSTAT.ZMPOIZ28 CONDITIONAL
   /*This job only runs if the C:D job does not end with*/
   /*a EXITCODE of 0.  It can be rerun as often as*/
   /*required to check the status of the C:D process.*/
   /*When the C:D process finishes, complete the job*/
   /*to release the successors.*/
   AGENT CYBA_ISBFP3
   USER cduser
   STMPTM= WOBDATA('PARMSET.!ESPAPPL','STMPTM')
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   CMDNAME /apps/condir/bfsbin/cdstat.sh
   ARGS !STMPTM  j!PID
   RUN WEEKDAYS
ENDJOB

NT_JOB MSIS_DATA_LOADBAT
   AGENT CYBA_CDC1AKFIS
   USER bfusa\maestro
   CMDNAME D:\DTS_RUN\BatchFiles\MSIS\MSISDataLoad.bat
   RUN WORKDAYS
   RELEASE ADD(AR_ZMMPOI15_PO_ADD_CHGTXT)
ENDJOB

UNIX_JOB AR_ZMMPOI15_PO_ADD_CHGTXT
   AGENT CYBA_ISBFP3
   USER bfpadm
   SCRIPTNAME /local/bin/arcfile.sh
   ARGS interfaces/output/dataout/zmmpoi15_po_add_chg.txt D
   RUN WORKDAYS
   RELEASE ADD(MSISPODATETOSAPBAT)
ENDJOB

NT_JOB MSISPODATETOSAPBAT
   AGENT CYBA_CDC1AKFIS
   USER bfusa\maestro
   CMDNAME D:\DTS_RUN\BATCHFILES\MSIS\MSISPODateToSAP.bat
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI13CD)
ENDJOB

JOB SETPID2.!ESPAPPL LINK PROCESS
   /*get the next PID number from the ConnectDirect*/
   /*Process ID table (CDPROD).  Save the value into*/
   /*the applications DataObject for use by the C:D*/
   /*job and the CDSTAT job (if needed).*/
   VINCR (PID) TABLE(CDPROD) CLANG
   VGET  (PID) TABLE(CDPROD) CLANG
   ESP MGRMSG * . . . PARMSET.!ESPAPPL/!ESPAPPL..!ESPAPGEN/MAIN +
ACTION SET PID(!PID)
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI13CD)
ENDJOB

UNIX_JOB ZMMPOI13CD
   AGENT CYBA_ISBFP3
   USER cdprod
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   TMSTMP= WOBDATA('PARMSET.!ESPAPPL','TMSTMP')
   SCRIPTNAME /apps/condir/bfsbin/submitcd.sh
   ARGS zmmpoi13.cd 15 !PID !TMSTMP
   RUN WORKDAYS
   EARLYSUB REALNOW PLUS 20 SECONDS
   RESOURCE ADD(1,ISBFP3CD)
   RELEASE ADD(CDSTAT.ZMPOIZ24(A))
   RELEASE ADD(ZMMPOI13_MSIS_TO_SAP_PO_CHANGES)
ENDJOB

AIX_JOB CDSTAT.ZMPOIZ24 CONDITIONAL
   /*This job only runs if the C:D job does not end with*/
   /*a EXITCODE of 0.  It can be rerun as often as*/
   /*required to check the status of the C:D process.*/
   /*When the C:D process finishes, complete the job*/
   /*to release the successors.*/
   AGENT CYBA_ISBFP3
   USER cduser
   STMPTM= WOBDATA('PARMSET.!ESPAPPL','STMPTM')
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   CMDNAME /apps/condir/bfsbin/cdstat.sh
   ARGS !STMPTM  j!PID
   RUN WORKDAYS
ENDJOB

SAP_JOB ZMMPOI13_MSIS_TO_SAP_PO_CHANGES
   AGENT CYBB_BFP030
   SAPJOBNAME ZMMPOI13_MSIS_TO_SAP_PO_CHANGES
   SAPJOBCLASS A
   ABAPNAME ZMMPOI13
   VARIANT PRODUCTION
   SAPUSER SAPADM
   LANGUAGE E
   PRINTDEST CC16
   EXPIRATION 8
   COLUMNS 132
   BANNER YES
   RECIPIENT CULLIMORECHE
   ARCMODE PRINT
   PRINTCOPIES 001
   RUN WORKDAYS
   RELEASE ADD(MSISPODATETOSAPCLEARBAT)
ENDJOB

NT_JOB MSISPODATETOSAPCLEARBAT
   AGENT CYBA_CDC1AKFIS
   USER bfusa\maestro
   CMDNAME D:\DTS_RUN\BATCHFILES\MSIS\MSISPODateToSAPCLEAR.bat
   RUN WORKDAYS
   RELEASE ADD(AR_ZMMPOI13_PO_CHG_TO_SAPTXT)
ENDJOB

UNIX_JOB AR_ZMMPOI13_PO_CHG_TO_SAPTXT
   AGENT CYBA_ISBFP3
   USER bfpadm
   SCRIPTNAME /local/bin/arcfile.sh
   ARGS interfaces/input/datain/zmmpoi13_po_chg_to_sap.txt D
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI14_SAP_TO_MSIS_PO_RECEIPTS)
ENDJOB

SAP_JOB ZMMPOI14_SAP_TO_MSIS_PO_RECEIPTS
   AGENT CYBB_BFP030
   SAPJOBNAME ZMMPOI14_SAP_TO_MSIS_PO_RECEIPTS
   STEPUSER SAPADM
   SAPJOBCLASS C
   STARTMODE ASAP
   ABAPNAME ZMMPOI14
   VARIANT PRODUCTION
   LANGUAGE E
   PRINTDEST WINP
   PRINTCOPIES 001
   PRINTREL YES
   EXPIRATION 8
   COLUMNS 170
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI14CD)
ENDJOB

JOB SETPID3.!ESPAPPL LINK PROCESS
   /*get the next PID number from the ConnectDirect*/
   /*Process ID table (CDPROD).  Save the value into*/
   /*the applications DataObject for use by the C:D*/
   /*job and the CDSTAT job (if needed).*/
   VINCR (PID) TABLE(CDPROD) CLANG
   VGET  (PID) TABLE(CDPROD) CLANG
   ESP MGRMSG * . . . PARMSET.!ESPAPPL/!ESPAPPL..!ESPAPGEN/MAIN +
ACTION SET PID(!PID)
   RUN WORKDAYS
   RELEASE ADD(ZMMPOI14CD)
ENDJOB

UNIX_JOB ZMMPOI14CD
   AGENT CYBA_ISBFP3
   USER cdprod
   EARLYSUB REALNOW PLUS 20 SECONDS
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   TMSTMP= WOBDATA('PARMSET.!ESPAPPL','TMSTMP')
   SCRIPTNAME /apps/condir/bfsbin/submitcd.sh
   ARGS zmmpoi14.cd 15 !PID !TMSTMP
   RUN WORKDAYS
   RESOURCE ADD(1,ISBFP3CD)
   RELEASE ADD(CDSTAT.ZMPOIZ26(A))
   RELEASE ADD(MSISPORECEIPTBAT)
ENDJOB

AIX_JOB CDSTAT.ZMPOIZ26 CONDITIONAL
   /*This job only runs if the C:D job does not end with*/
   /*a EXITCODE of 0.  It can be rerun as often as*/
   /*required to check the status of the C:D process.*/
   /*When the C:D process finishes, complete the job*/
   /*to release the successors.*/
   AGENT CYBA_ISBFP3
   USER cduser
   STMPTM= WOBDATA('PARMSET.!ESPAPPL','STMPTM')
   PID= WOBDATA('PARMSET.!ESPAPPL','PID')
   CMDNAME /apps/condir/bfsbin/cdstat.sh
   ARGS !STMPTM  j!PID
   RUN WORKDAYS
ENDJOB

NT_JOB MSISPORECEIPTBAT
   AGENT CYBA_CDC1AKFIS
   USER bfusa\maestro
   CMDNAME D:\DTS_RUN\BATCHFILES\MSIS\MSISPOReceiptLOAD.bat
   RUN WORKDAYS
   RELEASE ADD(AR_ZMMPOI14_RECEIPTSTXT)
ENDJOB

UNIX_JOB AR_ZMMPOI14_RECEIPTSTXT
   AGENT CYBA_ISBFP3
   USER bfpadm
   SCRIPTNAME /local/bin/arcfile.sh
   ARGS interfaces/output/dataout/zmmpoi14_receipts.txt D
   RUN WORKDAYS
   RELEASE ADD(LIE.!ESPAPPL)
ENDJOB

JOB LIE.!ESPAPPL LINK PROCESS
   RUN WORKDAYS
ENDJOB

