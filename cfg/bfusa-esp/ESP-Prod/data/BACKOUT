IF !USER1 = '' & !USER2 = '' THEN DO
 SEND 'USER1=APPLICATION NAME ..PLEASE RETRIGGER' USER(!ESPTRUSR)
 SEND 'USER2=APPLICATION GEN# ..PLEASE RETRIGGER' USER(!ESPTRUSR)
 EXIT
ENDDO

IF !USER1 = '' THEN DO
 SEND 'USER1=APPLICATION NAME ..PLEASE RETRIGGER' USER(!ESPTRUSR)
 EXIT
ENDDO

IF !USER2 = '' THEN DO
 SEND 'USER2=APPLICATION GEN# ..PLEASE RETRIGGER' USER(!ESPTRUSR)
 EXIT
ENDDO

/* THE PROCEDURE IS USED TO BACKOUT A ENTIRE ESP APPLICATION    */
/*
/* CREATE A EVENT AND TRIGGER IT USING THE USER1 AS THE         */
/* APPLICATION NAME AND USER2 AS THE APPLICATION GENERATION     */
/* YOU WANT TO BACKOUT.  REMEMBER THAT IF THE APPLICATION       */
/* HAS ALREADY BEEN ARCHIVED OFF OF THE HISTFILE THE BACKOUT    */
/* WILL NOT HAVE ANY DATA TO BE PROCESSED.                      */
/*
/* WHEN THE EVENT IS TRIGGERED "JCL" WILL BE BUILT TO PROCESS   */
/* THE ENTIRE BACKOUT.  YOU CAN TSO SUBMIT OR INSERT THE JOB.   */
/* IF THE JOB IN THE APPLICATION IS ANYTHING OTHER THAN A MVS   */
/*
/* JOB A STEP WITHIN THE BACKOUT WILL BE BUILT.  A MESSAGE WILL */
/* BE STATED THAT THERE WAS NOTHING TO BE BACKED OUT.           */

   REXXON

     APPLN=CLANGVAR('!USER1')       /* APPLICATION NAME             */
     APPLG=CLANGVAR('!USER2')       /* APPLICATION GENERATION       */
     SUBAP=CLANGVAR('!USER3')       /* SUBAPPLICATION NAME          */
     JOBNAME=CLANGVAR('!USER4')     /* JOBNAME                      */
     SUBSYS=CLANGVAR('!ESPSUBSYS')  /* ESP SUBSYSTEM                */

    /* THE APPLICATION IS LISTED TO GET THE JOBNAME AND JES#    */

    IF JOBNAME = '' & SUBAP = '' THEN DO
        "ESP LAP "APPLN"."APPLG" ALL"
      X = TRAPOUT('LINE.')
        "ESP LAP "APPLN"."APPLG" ALL"
      X = TRAPOUT('OFF')
      /*                       */
      /*  DO Y = 1 TO LINE.0   */
      /*    SAY LINE.Y         */
      /*  END                  */
      /*                       */
    END

    IF SUBAP ^= '' THEN DO
      X = TRAPOUT('LINE.')
        "ESP LAP "APPLN"."APPLG" SUBAPPL("SUBAP") ALL"
      X = TRAPOUT('OFF')
    END

    IF JOBNAME ^= '' THEN DO
      X = TRAPOUT('LINE.')
        "ESP LAP "APPLN"."APPLG" JOB("JOBNAME")"
      X = TRAPOUT('OFF')
    END

    /* THE DO LOOP BELOW STRIPS OUT THE JOB QUAILIFIER AND      */
    /* THE COMMA AFTER THE JOBNAME.                             */

      DO I=1 TO LINE.0
        CHKSTR1=WORD(LINE.I,1)
        PERIODPOS = POS(".",CHKSTR1)
        IF PERIODPOS > 0 THEN CHKSTR1 = LEFT(CHKSTR1,PERIODPOS - 1)
        CHKSTR2=WORD(LINE.I,2)
        CHKSTR2=STRIP(CHKSTR2,,',')
        CHKSTR3=WORD(LINE.I,3)
        CHKSTR3=STRIP(CHKSTR3,,',')
    /* THE JOBCARD INFO IS QUEUED UP.                           */
    /* CHANGE THE DATASET NAME TO YOUR DATASET.                 */

    "ALLOCX DA('SWS.ESP.BACKOUT') F(MYINDD) SH"
       IF I = 1 THEN DO
     QUEUE "//TSOXXXXA JOB (XXXXXX,CSG2),MSGCLASS=X,CLASS=H,"
     QUEUE "//         USER=TSOXXXX,GROUP=JCJC"
       END

    /* THEN ALL OF THE JOBS ARE QUEUES UP FOR BACKOUT.          */
    /* A STEP FOR EVERY JOB WILL BE CREATED.                    */
    /* CHANGE THE EXEC STATEMENT TO YOUR ENCORE PROC.           */
    /* DELETE OR CHANGE STEPLIB LINE OF JCL.                    */
    /* CHANGE SUBSYS LINE OF JCL.                               */

           IF INDEX(CHKSTR3,'COMPLETED') > 0 THEN DO
             QUEUE "//"CHKSTR1" EXEC SWENCORE"
             QUEUE "//ENCPARMS DD *"
             QUEUE "SUBSYS ESPP"
             QUEUE "TYPE BACKOUT"
             QUEUE "JOBNAME "CHKSTR1""
             QUEUE "JOBID "CHKSTR2""
             QUEUE "/*"
             QUEUE "//*"
           END
      END
         QUEUE ""
         ADDRESS MVS "EXECIO * DISKW" MYINDD "(FINIS)"
         "FREEX FILE("MYINDD")"
   REXXOFF
   SEND 'SUBMIT THE JOB FROM SWS.ESP.BACKOUT' USER(!ESPTRUSR)
