APPL JCTEST09 WAIT NOPOST_WHILE_WAITING

INVOKE 'SWS.ESP.APPL.PROCLIB(#DISTRIB)'

/*********************************************************************/
/*    THIS IS A TEST OF THE ESP SCHEDULING SYSTEM                    */
/*********************************************************************/
/* - TESTING FILE READING JOBS                                       */
/*                                                                   */
/* - IMPORTANT -                                                     */
/* - THIS JOB ONLY SEARCHES FOR NEW LINES THAT ARE ADDED             */
/* - TO THE TEXT, AFTER THE ORIGINAL SEARCH HAS COMPLETED.           */
/* - IN OTHER WORDS, THE JOB READS THE FILE INITIALLY                */
/* - IF THE WORD IS NOT FOUND, IT RESUMES THE SEARCH,                */
/* - BUT NOT FROM THE TOP! IT WILL START FROM THE LAST LINE OF TEXT  */
/* - FROM THE PREVIOUS SEARCH. IT WILL LOOK FOR THAT WORD TO BE ADDED*/
/* - AS A NEW LINE OF TEXT.                                          */
/*********************************************************************/

NOTIFY FAILURE ABEND OVERDUE MAILBOX(SCHEDULERS)
TAG TEST

JOB FILE_READING_TEST LINK PROCESS
  RUN TODAY
  RELEASE ADD(SUCCESS.ESP_TEST_FILE_READING_JOB)
  RELEASE ADD(FAILURE.ESP_TEST_FILE_READING_JOB)
ENDJOB

TEXT_MON SUCCESS.ESP_TEST_FILE_READING_JOB
  AGENT APPCYB02PPD
  USER maestro
  TEXTFILE \\APPCYB02PPD\ESP$\ESP_TEST_FILE_READING.txt
  TEXTSTRING 'SUCCESS'
  SEARCHRANGE LINE FROM(1)
  /*NOW WILL CAUSE THE JOB TO FAIL IF THE TEXT IS NOT FOUND NOW */
  WAITMODE NOW
  RUN TODAY
  NORUN JAN 16 2034
  DUEOUT EXEC REALNOW PLUS 12 HOURS
  RELEASE ADD(SUCCESSFUL_END)
ENDJOB

TEXT_MON FAILURE.ESP_TEST_FILE_READING_JOB
  AGENT APPCYB02PPD
  USER maestro
  TEXTFILE \\APPCYB02PPD\ESP$\ESP_TEST_FILE_READING.txt
  TEXTSTRING 'FAILURE'
  SEARCHRANGE LINE FROM(1)
  /*WAIT WILL CAUSE JOB TO MONITOR THE FILE AND WAIT FOR THE TEXT*/
  WAITMODE WAIT
  RUN TODAY
  NORUN JAN 16 2034
  DUEOUT EXEC REALNOW PLUS 12 HOURS
  RELEASE ADD(ERROR_OCCURED)
ENDJOB

JOB SUCCESSFUL_END LINK PROCESS
  RUN TODAY
  RELEASE ADD(CALL_NEXT_JOB)
ENDJOB

JOB CALL_NEXT_JOB LINK PROCESS
  RUN TODAY
  RELEASE ADD(LIE.JCTEST09)
ENDJOB

JOB ERROR_OCCURED LINK PROCESS
  RUN TODAY
  RELEASE ADD(STOP_PROCESSING)
ENDJOB

JOB STOP_PROCESSING LINK PROCESS
  RUN TODAY
ENDJOB

APPLEND JCTEST09
  ESPNOMSG TRIGGER !ESPEVENT ADD
  NORUN TODAY
ENDJOB


