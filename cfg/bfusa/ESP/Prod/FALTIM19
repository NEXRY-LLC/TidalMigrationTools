APPL FALTIM18 WAIT HOLD

NOTIFY ABEND FAILURE ALERT(REMD)
INVOKE 'SWS.ESP.APPL.PROCLIB(#DISTRIB)'
JCLLIB 'SWS.FTRSW.PRDJOBS'

/*BFP -  Adapted from Weekly schedule to:*/
/*1) Lock users, shutdown application servers, ICLI's, DB2.*/
/*2) Take DB2 Snap backup.*/
/*3) Restart BFP.*/

JOB SHUTDOWN_AND_RESTART_OF_SAP_FOR_TIME_CHANGE LINK PROCESS HOLD
    RUN NOV 3 2019
    DELAYSUB 00.30
    RELEASE ADD(BFPLOCK.SAPBFPDB)
ENDJOB

UNIX_JOB BFPLOCK.SAPBFPDB
    AGENT CYBA_SAPBFPDB
    SCRIPTNAME /local/bin/db2lock.sh
    ARGS BFP
    USER root
    RUN NOV 3 2019
    RELEASE ADD(CONFIRM_NO_USERS_OR_ACTIVE_JOBS_ON_SAP)
ENDJOB

JOB CONFIRM_NO_USERS_OR_ACTIVE_JOBS_ON_SAP +
TASK PROCESS DOCMEM(NOACTSAP)
   RUN NOV 3 2019
   RELEASE ADD(SHUTDOWN_SAP)
ENDJOB

SAP_JOB BASIS_SUSPEND_BFP_BATCH_ONE
   AGENT CYBB_BFP030
   SAPJOBNAME BASIS_SUSPEND_BFP_BATCH
   SAPJOBCLASS A
   STARTMODE ASAP
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   RUN NOV 3 2019
   RELEASE ADD(BASIS_SUSPEND_BFP_BATCH_TWO)
ENDJOB

SAP_JOB BASIS_SUSPEND_BFP_BATCH_TWO
   AGENT CYBB_BFP030
   SAPJOBNAME BASIS_SUSPEND_BFP_BATCH
   SAPJOBCLASS A
   STARTMODE ASAP
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS1
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   RUN NOV 3 2019
   RELDELAY 1
   RELEASE ADD(STOSAP25.SP2N25X)
   RELEASE ADD(STOSBFP3.ISBFP3)
   RELEASE ADD(STOSBFP5.ISBFP5)
   RELEASE ADD(STOSBFP6.ISBFP6)
   RELEASE ADD(STOSBFP2.ISBFP2X)
ENDJOB

UNIX_JOB STOSAP25.SP2N25X
   AGENT CYBA_SP2N25
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOSBFP1.ISBFP1X)
ENDJOB

UNIX_JOB STOSBFP3.ISBFP3
   AGENT CYBA_ISBFP3
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOSBFP1.ISBFP1X)
ENDJOB

UNIX_JOB STOSBFP2.ISBFP2X
   AGENT CYBA_ISBFP2
   /*@@ "/local/bin/stop_sap.sh BFP"*/
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOSBFP1.ISBFP1X)
ENDJOB

UNIX_JOB STOSBFP5.ISBFP5
   AGENT CYBA_ISBFP5
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOSBFP1.ISBFP1X)
ENDJOB

UNIX_JOB STOSBFP6.ISBFP6
   AGENT CYBA_ISBFP6
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   RUN NOV 3 2019
   USER root
   RELEASE ADD(STOSBFP1.ISBFP1X)
ENDJOB

UNIX_JOB STOSBFP1.ISBFP1X
   AGENT CYBA_ISBFP1
   SCRIPTNAME /local/bin/stop_sap.sh
   ARGS BFP
   RUN NOV 3 2019
   USER root
   RELEASE ADD(STOP_SCHEDULING_AGENT)
   RELEASE ADD(BFPSTOPD.SAPBFPDB)
ENDJOB

UNIX_JOB STASBFP1.ISBFP1X
   AGENT CYBA_ISBFP1
   SCRIPTNAME /local/bin/start_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STASBFP3.ISBFP1X)
   RELEASE ADD(STASBFP2.ISBFP2X)
   RELEASE ADD(STASBFP5.ISBFP5)
   RELEASE ADD(STASBFP6.ISBFP6)
   RELEASE ADD(STASAP25.SP2N25X)
ENDJOB

UNIX_JOB STASBFP2.ISBFP2X
   AGENT CYBA_ISBFP2
   SCRIPTNAME /local/bin/start_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

UNIX_JOB BFPSTOPD.SAPBFPDB
    AGENT CYBA_SAPBFPDB
    SCRIPTNAME /local/bin/stop_db2.sh
    ARGS BFP
    USER root
    RUN NOV 3 2019
 /* RELEASE ADD(BFPSTRTD.SAPBFPDB)
    RELEASE ADD(STOP_HERE_FOR_TIME_CHANGE)
 ENDJOB

JOB STOP_HERE_FOR_TIME_CHANGE LINK PROCESS HOLD
    RUN NOV 3 2019
    RELEASE ADD(BFPSTRTD.SAPBFPDB)
ENDJOB


UNIX_JOB BFPSTRTD.SAPBFPDB
    AGENT CYBA_SAPBFPDB
    SCRIPTNAME /local/bin/start_db2.sh
    ARGS BFP
    USER root
    RUN NOV 3 2019
    RELEASE ADD(BFPDBSNP.SAPBFPDB)
    RELEASE ADD(SETWRITE_RESUME_BFPDBSNP)
 ENDJOB

UNIX_JOB BFPDBSNP.SAPBFPDB
   AGENT CYBA_OPMAPP
   SCRIPTNAME /local/bin/create_snap.sh
   ARGS sapbfpdb BFP weekly
   USER root
   RUN NOV 3 2019
   RELEASE ADD(START_SAP)
ENDJOB

UNIX_JOB SETWRITE_RESUME_BFPDBSNP
  AGENT CYBA_SAPBFPDB
  SCRIPTNAME /local/bin/db2_Set_Write_Resume.sh
  ARGS BFP
  EXITCODE 0-1 FAILURE
  EXITCODE 2 SUCCESS
  EXITCODE 3-9099 FAILURE
  USER root
  RUN NOV 3 2019
  RELDELAY 8
  RELEASE ADD(START_SAP)
ENDJOB

UNIX_JOB STASBFP5.ISBFP5
   AGENT CYBA_ISBFP5
   SCRIPTNAME /local/bin/start_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

UNIX_JOB STASBFP6.ISBFP6
   AGENT CYBA_ISBFP6
   SCRIPTNAME /local/bin/start_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

 UNIX_JOB STASBFP3.ISBFP1X
     AGENT CYBA_ISBFP1
     SCRIPTNAME /local/bin/start_sap_remote.sh
     ARGS isbfp3 BFP
     USER root
     RUN NOV 3 2019
     RELEASE ADD(STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
 ENDJOB

AIX_JOB STOP_SCHEDULING_AGENT
   AGENT CYBA_ISBFP3
   USER root
   SCRIPTNAME /local/bin/stop_at_cybr.sh
   RUN NOV 3 2019
 /*RELEASE ADD(START_SCHEDULING_AGENT)
   RELEASE ADD(STOP_HERE_FOR_TIME_CHANGE)
ENDJOB

AIX_JOB START_SCHEDULING_AGENT
   AGENT CYBA_BKPNBU05
   USER root
   SCRIPTNAME /local/bin/start_remote_cyb_process.sh
   ARGS isbfp3
   RUN NOV 3 2019
   RELEASE ADD(ISBFP3)
ENDJOB

JOB CONFIRM_RESTART_OF_SCHEDULING_AGENT TASK PROCESS DOCMEM(STARTESP)
   SEND 'CONFIRM start of scheduling agent on ISBFP3'
   RUN NOV 3 2019
   RELEASE ADD(START_SCHEDULING_AGENT)
ENDJOB

AIX_JOB ISBFP3
   AGENT CYBA_ISBFP3
   USER root
   SCRIPTNAME /local/bin/df.sh
   RUN NOV 3 2019
   RELDELAY  2
   RELEASE ADD(TP_SHOWBUFFER)
ENDJOB

UNIX_JOB STASAP25.SP2N25X
   AGENT CYBA_SP2N25
   SCRIPTNAME /local/bin/start_sap.sh
   ARGS BFP
   USER root
   RUN NOV 3 2019
   RELEASE ADD(STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

JOB BFPULOCK
   MEMBER USIEBR14
   RUN NOV 3 2019
   RELEASE ADD(SHUTDOWN_AND_RESTART_FOR_TIME_CHANGE_COMPLETE)
ENDJOB

JOB SHUTDOWN_AND_RESTART_FOR_TIME_CHANGE_COMPLETE LINK PROCESS
   RUN NOV 3 2019
ENDJOB

AIX_JOB TP_SHOWBUFFER
   AGENT CYBA_ISBFP3
   USER bfpadm
   CMDNAME /sapmnt/BFP/exe/tp
   ARGS showbuffer BFP pf=/usr/sap/trans/bin/TPPARAM
   RUN NOV 3 2019
   RELEASE ADD(BASIS_RESUME_BFP_BATCH)
ENDJOB

SAP_JOB BASIS_RESUME_BFP_BATCH
   AGENT CYBB_BFP030
   SAPJOBNAME BASIS_RESUME_BFP_BATCH
   SAPJOBCLASS A
   STARTMODE ASAP
   ABAPNAME BTCTRNS2
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS2
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   ABAPNAME BTCTRNS2
   STEPUSER SAPADM
   LANGUAGE E
   PRINTDEST LP01
   EXPIRATION 8
   LINES 65
   COLUMNS 80
   BANNER D
   RECIPIENT SAPADM
   ARCMODE PRINT
   PRINTCOPIES 001
   RUN NOV 3 2019
   RELDELAY 2
   RELEASE ADD(BFPULCK1.SAPBFPDB)
ENDJOB

UNIX_JOB BFPULCK1.SAPBFPDB
    AGENT CYBA_SAPBFPDB
    SCRIPTNAME /local/bin/db2unlock.sh
    ARGS BFP
    USER root
    RUN NOV 3 2019
    RELEASE ADD(BFPULOCK)
ENDJOB

JOB BFPULOCK
   MEMBER USIEBR14
   RUN NOV 3 2019
   RELEASE ADD(LIE.WKLYBBFP)
ENDJOB

JOB SHUTDOWN_SAP LINK PROCESS HOLD
  RUN NOV 3 2019
  RELEASE ADD(BASIS_SUSPEND_BFP_BATCH_ONE)
ENDJOB

JOB STOP_CONNECTIONS_BETWEEN_SABRIX_AND_SAP LINK PROCESS
   RUN NOV 3 2019
   RELDELAY 1
   IF TODAY('APR 16 2017') THEN JOBATTR HOLD
   RELEASE ADD(P1SXSTOP)
   RELEASE ADD(P2SXSTOP)
   RELEASE ADD(P3SXSTOP.ISBFP1X)
   RELEASE ADD(N25SXSTOP)
   RELEASE ADD(P5SXSTOP)
   RELEASE ADD(P6SXSTOP)
ENDJOB

AIX_JOB P1SXSTOP
   AGENT CYBA_ISBFP1
   USER sbxadm
   SCRIPTNAME /local/bin/stop_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELDELAY 3
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

AIX_JOB P2SXSTOP
   AGENT CYBA_ISBFP2
   USER sbxadm
   SCRIPTNAME /local/bin/stop_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELDELAY 4
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

AIX_JOB P3SXSTOP.ISBFP1X
   AGENT CYBA_ISBFP1
   USER root
   SCRIPTNAME /local/bin/stop_sabrix_connector_remote.sh
   ARGS isbfp3 BFP
   RUN NOV 3 2019
   RELDELAY 5
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

AIX_JOB N25SXSTOP
   AGENT CYBA_SP2N25
   USER sbxadm
   SCRIPTNAME /local/bin/stop_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

AIX_JOB P5SXSTOP
   AGENT CYBA_ISBFP5
   USER sbxadm
   SCRIPTNAME /local/bin/stop_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELDELAY 1
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

AIX_JOB P6SXSTOP
   AGENT CYBA_ISBFP6
   USER sbxadm
   SCRIPTNAME /local/bin/stop_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELDELAY 2
   RELEASE ADD(RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP)
ENDJOB

JOB RESTART_CONNECTIONS_BETWEEN_SABRIX_AND_SAP LINK PROCESS
   RUN NOV 3 2019
   RELDELAY 1
   RELEASE ADD(P1SXSTART)
   RELEASE ADD(P2SXSTART)
   RELEASE ADD(N25SXSTART)
   RELEASE ADD(P3SXSTART.ISBFP1X)
   RELEASE ADD(P5SXSTART)
   RELEASE ADD(P6SXSTART)
ENDJOB

AIX_JOB P1SXSTART
   AGENT CYBA_ISBFP1
   USER sbxadm
   SCRIPTNAME /local/bin/start_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

AIX_JOB P2SXSTART
   AGENT CYBA_ISBFP2
   USER sbxadm
   SCRIPTNAME /local/bin/start_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

AIX_JOB P3SXSTART.ISBFP1X
   AGENT CYBA_ISBFP1
   USER root
   SCRIPTNAME /local/bin/start_sabrix_connector_remote.sh
   ARGS isbfp3 BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

AIX_JOB N25SXSTART
   AGENT CYBA_SP2N25
   USER sbxadm
   SCRIPTNAME /local/bin/start_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

AIX_JOB P5SXSTART
   AGENT CYBA_ISBFP5
   USER sbxadm
   SCRIPTNAME /local/bin/start_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

AIX_JOB P6SXSTART
   AGENT CYBA_ISBFP6
   USER sbxadm
   SCRIPTNAME /local/bin/start_sabrix_connector.sh
   ARGS BFP
   RUN NOV 3 2019
   RELEASE ADD(CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE)
ENDJOB

JOB CONFIRM_CONNECTIONS_BETWEEN_SABRIX_AND_SAP_ARE_ACTIVE +
TASK PROCESS DOCMEM(SXPTOSAP)
   SEND 'Confirm SAP/Sabrix connectors have been restarted and active'
   RUN NOV 3 2019
   RELEASE ADD(START_SCHEDULING_AGENT)
ENDJOB

JOB START_SAP LINK PROCESS
   RUN NOV 3 2019
   RELEASE ADD(STASBFP1.ISBFP1X)
ENDJOB

                                                                        02850006


